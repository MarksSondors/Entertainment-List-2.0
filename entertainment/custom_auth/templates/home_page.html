{% extends "components/base.html" %}
{% load static %}

{% block content %}
    <!-- Hero section with welcome message -->
    <div class="row px-2 py-2">
        <div class="col-12 mb-3">
            <div class="window" style="width: 100%;">
                <div class="title-bar">
                    <div class="title-bar-text">Entertainment List - Welcome</div>
                    <div class="title-bar-controls">
                        <button aria-label="Minimize"></button>
                        <button aria-label="Maximize"></button>
                        <button aria-label="Close"></button>
                    </div>
                </div>
                <div class="window-body">
                    <div class="field-row-stacked" style="text-align: center;">
                        <img src="{% static 'images/frontend-logo.png' %}" alt="Entertainment List Logo" style="width: 25%; max-width: 100px;" />
                        <h1 style="color: #5e9ca0; font-size: clamp(18px, 5vw, 24px);">
                            <span style="background-color: #ff00ff; color: #ffffff;">Welcome to <span style="color: #0000ff;">Entertainment</span> List!</span>
                        </h1>
                        <p style="color: #222; padding: 10px; font-size: 16px; max-width: 800px; margin: 0 auto;">
                            Whether the latest cinematic universe has a "definitive ranking" or not is irrelevant from our perspective. However, its evolution is joyously significant to us at Entertainment List. The joy is that our dedicated platform has made it clear to us that this moment is the "marker" we've been waiting forâ€”the time to fully immerse ourselves in managing our favorite movies, shows, and more, all in one place.
                        </p>
                    </div>
                </div>
                <div class="status-bar">
                    <div class="status-bar-field">Ready</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main content area -->
    <div class="row px-2 pb-3">
        <!-- Left column - Actions -->
        <div class="col-12 col-md-4 mb-3">
            <div class="window" style="width: 100%;">
                <div class="title-bar">
                    <div class="title-bar-text">Quick Actions</div>
                    <div class="title-bar-controls">
                        <button aria-label="Minimize"></button>
                        <button aria-label="Maximize"></button>
                        <button aria-label="Close"></button>
                    </div>
                </div>
                <div class="window-body">
                    <fieldset>
                        <legend>Add Content</legend>
                        <ul class="tree-view">
                            <li>
                                <a href="javascript:void(0);" onclick="openModal()" style="display: flex; align-items: center; padding: 5px 0;">
                                    <img src="https://liseklucian.neocities.org/buttons/ie_animated.gif" alt="Add Movie" style="max-width: 88px; margin-right: 10px;">
                                    <span>Add Movie</span>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0);" onclick="openTVShowModal()" style="display: flex; align-items: center; padding: 5px 0;">
                                    <img src="https://liseklucian.neocities.org/buttons/bandwith_conservation_society.gif" alt="Add TV Show" style="max-width: 88px; margin-right: 10px;">
                                    <span>Add TV Show</span>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0);" onclick="openBookModal()" style="display: flex; align-items: center; padding: 5px 0;">
                                    <img src="https://fustilugz.neocities.org/four/adultchat.gif" alt="Add Book" style="max-width: 88px; margin-right: 10px;">
                                    <span>Add Book</span>
                                </a>
                            </li>
                            <li>
                                <a href="javascript:void(0);" onclick="openAlbumModal()" style="display: flex; align-items: center; padding: 5px 0;">
                                    <img src="https://fustilugz.neocities.org/buttons/12/button-tupachq1.gif" alt="Add Music" style="max-width: 88px; margin-right: 10px;">
                                    <span>Add Music</span>
                                </a>
                            </li>
                        </ul>
                    </fieldset>
                    
                    <fieldset>
                        <legend>Explore</legend>
                        <ul class="tree-view">
                            <li>
                                <a href="{% url 'watchlist_page' %}" style="display: flex; align-items: center; padding: 5px 0;">
                                    <img src="https://anlucas.neocities.org/bookmark_this_page.gif" alt="View Watchlist" style="max-width: 88px; margin-right: 10px;">
                                    <span>Your Watchlist</span>
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'all_movies_page' %}" style="display: flex; align-items: center; padding: 5px 0;">
                                    <img src="https://cyber.dabamos.de/88x31/88-31-banner.gif" alt="All Movies" style="max-width: 88px; margin-right: 10px;">
                                    <span>All Movies</span>
                                </a>
                            </li>
                            <li>
                                <a href="" style="display: flex; align-items: center; padding: 5px 0;">
                                    <img src="https://anlucas.neocities.org/got_html.gif" alt="Get Recommendations" style="max-width: 88px; margin-right: 10px;">
                                    <span>Recommendations</span>
                                </a>
                            </li>
                            <li>
                                <a href="" style="display: flex; align-items: center; padding: 5px 0;">
                                    <img src="https://cyber.dabamos.de/88x31/88ibet.gif" alt="Manage Account" style="max-width: 88px; margin-right: 10px;">
                                    <span>Your Account</span>
                                </a>
                            </li>
                        </ul>
                    </fieldset>
                </div>
                <div class="status-bar">
                    <div class="status-bar-field">Select an action to continue</div>
                </div>
            </div>
        </div>
        
        <!-- Right column - Content -->
        <div class="col-12 col-md-8">
            <!-- Popular Content -->
            <div class="window mb-3" style="width: 100%;">
                <div class="title-bar">
                    <div class="title-bar-text">Popular Content</div>
                    <div class="title-bar-controls">
                        <button aria-label="Minimize"></button>
                        <button aria-label="Maximize"></button>
                        <button aria-label="Close"></button>
                    </div>
                </div>
                <div class="window-body">
                    <menu role="tablist">
                        <li role="tab" aria-selected="true"><a href="#movies-tab">Movies</a></li>
                        <li role="tab"><a href="#tv-tab">TV Shows</a></li>
                        <li role="tab"><a href="#books-tab">Books</a></li>
                        <li role="tab"><a href="#music-tab">Music</a></li>
                    </menu>
                    
                    <!-- Movies Tab -->
                    <div class="window" role="tabpanel" id="movies-tab">
                        <div class="window-body">
                            <fieldset>
                                <legend>Top 5 Popular Movies</legend>
                                <ul id="popular_movies_block" class="tree-view">
                                    <li class="loading">Loading popular movies...</li>
                                </ul>
                            </fieldset>
                        </div>
                    </div>
                    
                    <!-- TV Shows Tab -->
                    <div class="window" role="tabpanel" id="tv-tab" style="display: none;">
                        <div class="window-body">
                            <fieldset>
                                <legend>Top 5 Popular TV Shows</legend>
                                <ul id="popular_tvshows_block" class="tree-view">
                                    <li class="loading">Loading popular shows...</li>
                                </ul>
                            </fieldset>
                        </div>
                    </div>

                    <!-- Books Tab -->
                    <div class="window" role="tabpanel" id="books-tab" style="display: none;">
                        <div class="window-body">
                            <fieldset>
                                <legend>Top 5 Popular Books</legend>
                                <ul id="popular_books_block" class="tree-view">
                                    <li class="loading">Loading popular books...</li>
                                </ul>
                            </fieldset>
                        </div>
                    </div>

                    <!-- Music Tab -->
                    <div class="window" role="tabpanel" id="music-tab" style="display: none;">
                        <div class="window-body">
                            <fieldset>
                                <legend>Top 5 Popular Music</legend>
                                <ul id="popular_music_block" class="tree-view">
                                    <li class="loading">Loading popular music...</li>
                                </ul>
                            </fieldset>
                        </div>
                    </div>
                </div>
                <div class="status-bar">
                    <div class="status-bar-field">Updated hourly</div>
                </div>
            </div>
            
            <!-- Recent Reviews -->
            <div class="window" style="width: 100%;">
                <div class="title-bar">
                    <div class="title-bar-text">Recent Community Reviews</div>
                    <div class="title-bar-controls">
                        <button aria-label="Minimize"></button>
                        <button aria-label="Maximize"></button>
                        <button aria-label="Close"></button>
                    </div>
                </div>
                <div class="window-body" style="background-color: #eee; color: #333; font-family: 'MS Sans Serif', sans-serif; padding: 10px;">
                    <div style="overflow-y: auto; max-height: 200px; padding: 5px; border: 1px inset #d5d5d5;">
                        <ul id="recent_reviews" class="tree-view">
                            <li>> john_doe: "Amazing movie, a must-watch!" <br> Movie: Inception <br> Rating: â˜…â˜…â˜…â˜…â˜…</li>
                            <li>> jane_smith: "Not my cup of tea, but well-made." <br> Movie: Titanic <br> Rating: â˜…â˜…â˜…â˜†â˜†</li>
                            <li>> movie_buff99: "A cinematic masterpiece!" <br> Movie: The Godfather <br> Rating: â˜…â˜…â˜…â˜…â˜…</li>
                            <li>> casual_viewer: "It was okay, nothing special." <br> Movie: Avatar <br> Rating: â˜…â˜…â˜†â˜†â˜†</li>
                            <li>> critic101: "Overhyped, but still enjoyable." <br> Movie: The Dark Knight <br> Rating: â˜…â˜…â˜…â˜…â˜†</li>
                        </ul>
                    </div>
                    <div class="field-row" style="justify-content: flex-end; margin-top: 10px;">
                        <button onclick="window.location.href=''">See All Reviews</button>
                        <button onclick="window.location.href=''">Write a Review</button>
                    </div>
                </div>
                <div class="status-bar">
                    <div class="status-bar-field">Last updated: Today</div>
                </div>
            </div>
        </div>
    </div>

    {% include 'movie_search_modal.html' %}
    {% include 'tv_show_search_modal.html' %}
    {% include 'album_search_modal.html' %}
    
    <style>
        .tree-view li {
            margin-bottom: 8px;
            padding: 5px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .tree-view li a {
            text-decoration: none;
            color: inherit;
        }
        
        .tree-view li a:hover {
            background-color: #e0e0e0;
        }
        
        .loading {
            color: #666;
            font-style: italic;
        }
        
        menu[role="tablist"] {
            display: flex;
            flex-wrap: wrap;
        }
        
        menu[role="tablist"] li {
            margin-right: 5px;
        }
        
        @media (max-width: 768px) {
            .tree-view li a {
                flex-wrap: wrap;
                padding: 10px 0;
            }
            
            .tree-view li a img {
                margin-bottom: 5px;
            }
            
            menu[role="tablist"] {
                justify-content: center;
            }
        }
    </style>
    
    <script>
        // Modal functions
        function openBookModal() {
            alert("Book feature coming soon!");
            // Implement book modal when ready
        }
    
        // Fetch popular movies
        fetch('/movies/popular/')
            .then(response => response.json())
            .then(data => {
                const movieList = document.getElementById('popular_movies_block');
                movieList.innerHTML = '';
                if (data.length === 0) {
                    movieList.innerHTML = '<li>No movies found</li>';
                    return;
                }
                data.forEach(movie => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <a href="/movies/${movie.id}" style="display: flex; align-items: center; padding: 5px 0;">
                            <img src="${movie.poster_path || '{% static "images/no-poster.png" %}'}" alt="${movie.title}" style="width: 50px; height: auto; margin-right: 10px;">
                            <div>
                                <strong>${movie.title}</strong>
                                <br>
                                <small>Rating: ${movie.vote_average}/10</small>
                            </div>
                        </a>
                    `;
                    movieList.appendChild(listItem);
                });
            })
            .catch(error => {
                console.error('Error fetching popular movies:', error);
                document.getElementById('popular_movies_block').innerHTML = '<li>Failed to load movies</li>';
            });
            
        // Fetch popular TV shows
        fetch('/tvshows/popular/')
            .then(response => response.json())
            .then(data => {
                const tvList = document.getElementById('popular_tvshows_block');
                tvList.innerHTML = '';
                if (data.length === 0) {
                    tvList.innerHTML = '<li>No TV shows found</li>';
                    return;
                }
                data.forEach(show => {
                    const listItem = document.createElement('li');
                    listItem.innerHTML = `
                        <a href="/tvshows/detail/${show.id}" style="display: flex; align-items: center; padding: 5px 0;">
                            <img src="${show.poster_path || '{% static "images/no-poster.png" %}'}" alt="${show.name}" style="width: 50px; height: auto; margin-right: 10px;">
                            <div>
                                <strong>${show.name}</strong>
                                <br>
                                <small>Rating: ${show.vote_average}/10</small>
                            </div>
                        </a>
                    `;
                    tvList.appendChild(listItem);
                });
            })
            .catch(error => {
                console.error('Error fetching popular TV shows:', error);
                document.getElementById('popular_tvshows_block').innerHTML = '<li>Failed to load TV shows</li>';
            });
            
        // For books and music tabs - placeholder data until endpoints are ready
        document.getElementById('popular_books_block').innerHTML = 
            '<li><img src="https://64.media.tumblr.com/b1b34aa74e3df63058c136e3abb67f44/f2330a1cf397e970-9c/s400x600/32d2402d6fbfb4fdf2c478a8c871c6412e2441f4.jpg" alt="Coming Soon" ><br>Book integration coming soon!</li>';
        document.getElementById('popular_music_block').innerHTML = 
            '<li><img src="https://64.media.tumblr.com/b1b34aa74e3df63058c136e3abb67f44/f2330a1cf397e970-9c/s400x600/32d2402d6fbfb4fdf2c478a8c871c6412e2441f4.jpg" alt="Coming Soon" ><br>Music integration coming soon!</li>';
        
        // Tab switching functionality
        document.addEventListener('DOMContentLoaded', function() {
            const tabs = document.querySelectorAll('menu[role="tablist"] li[role="tab"]');
            const tabPanels = document.querySelectorAll('div[role="tabpanel"]');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Deselect all tabs
                    tabs.forEach(t => t.removeAttribute('aria-selected'));
                    
                    // Select clicked tab
                    this.setAttribute('aria-selected', 'true');
                    
                    // Hide all tab panels
                    tabPanels.forEach(panel => panel.style.display = 'none');
                    
                    // Show selected tab panel
                    const targetId = this.querySelector('a').getAttribute('href');
                    document.querySelector(targetId).style.display = 'block';
                });
            });
            
            // Fetch recent reviews (could be implemented in the future)
            // fetchRecentReviews();
        });
    </script>
{% endblock %}